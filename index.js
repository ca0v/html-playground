(()=>{var ue=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var T=(r,e,t)=>(ue(r,e,"read from private field"),t?t.call(r):e.get(r)),he=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},fe=(r,e,t,o)=>(ue(r,e,"write to private field"),o?o.call(r,t):e.set(r,t),t);var u=(r,e,t)=>new Promise((o,n)=>{var a=i=>{try{s(t.next(i))}catch(c){n(c)}},l=i=>{try{s(t.throw(i))}catch(c){n(c)}},s=i=>i.done?o(i.value):Promise.resolve(i.value).then(a,l);s((t=t.apply(r,e)).next())});var F=class{constructor(){this.stopped=!0;this.autostart=!0;this._callbacks={};this.recognition=new window.webkitSpeechRecognition;let e=this.recognition;e.interimResults=!1,e.continuous=!1,e.lang="en-PH",e.maxAlternatives=5,e.addEventListener("start",t=>{this.stopped=!1}),e.addEventListener("end",t=>{this.stopped=!1,this.autostart&&e.start()}),e.addEventListener("result",t=>{for(let o=0;o<t.results.length;o++){let n=t.results[o];if(n.isFinal)for(let a=0;a<n.length;a++){let l=n[a].transcript;console.log(l,n[a]);let s=n[a].confidence;this.trigger("speech-detected",{result:l,power:s*100});return}}})}callbacks(e){var t;return this._callbacks[e]=(t=this._callbacks[e])!=null?t:[]}on(e,t){this.callbacks(e).push(t)}trigger(e,t){this.callbacks(e).forEach(o=>o(t))}listen(){this.stopped&&this.recognition.start()}};var Le=5e3,ke=1500;function ge(r){return u(this,null,function*(){return new Promise((e,t)=>{r.classList.add("fade-out"),setTimeout(()=>e(r),ke)})})}var D=class{constructor(e){this.target=e;Array.from(e.querySelectorAll(".toast")).map(t=>this.destroyToast(t))}toast(e){this.target.classList.remove("fade-out");let t=document.createElement("div");t.classList.add("toast"),t.innerText=e,this.target.insertBefore(t,this.target.firstElementChild),setTimeout(()=>this.destroyToast(t),Le)}destroyToast(e){return u(this,null,function*(){yield ge(e),e.remove(),this.target.querySelector(".toast")||ge(this.target)})}};function ye(r){let e=r.split(" ");return e.shift(),e.join(" ")}var G=class{parsePhrase(e){e=e.toLowerCase();let t={"zoom in":"zoom","zoom out":"zoom",drag:"pan","number for":"4",number:"",frame:"",photo:"",one:"1",two:"2",three:"3",four:"4",five:"5",six:"6",seven:"7",eight:"8",nine:"9",into:"",on:"",and:"",picture:"","go to":"goto","-":" "};Object.keys(t).forEach(n=>e=e.replace(n,t[n]));let o=e.split(" ");return o=o.map(n=>{var a;return(a=t[n])!=null?a:n}).filter(n=>!!n),o.join(" ")}};var O=class{constructor(e){this.image=e;this.x=this.y=this.r=0,this.s=1}transform(e){this.x+=e.dx||0,this.y+=e.dy||0,this.r+=e.angle||0,this.s*=e.scale||1,this.image.style.transform=`translate(${this.x}px,${this.y}px) rotate(${this.r}deg) scale(${this.s})`}translate(e,t){return this.transform({dx:e,dy:t})}rotate(e){return this.transform({angle:e})}scale(e){return this.transform({scale:e})}upscale(e){let t=getComputedStyle(this.image),o=parseFloat(t.width),n=parseFloat(t.height);this.scale(1/e),this.image.style.width=e*o+"px",this.image.style.height=e*n+"px",this.translate(o/2-o*e/2,n/2-n*e/2)}};var Te="px em".split(" ");function Se(r){return Te.some(e=>r.endsWith(e))}var E=class{constructor(e){this.panel=e;this.photo=null,this.image=document.createElement("img"),this.sprite=new O(this.image),this.image.classList.add("img"),this.image.draggable=!1,this.panel.appendChild(this.image),this.asPanel(this.panel)}addPhoto(e){this.photo=e,this.setBackgroundImage(e.mediaInfo.baseUrl)}get photoWidth(){return parseInt(window.getComputedStyle(this.image).width)}get photoHeight(){return parseInt(window.getComputedStyle(this.image).height)}get photoScale(){let t=window.getComputedStyle(this.image).height;return t==="auto"?1:parseFloat(t)/100}get overlay(){return this.panel.querySelector(".overlay")}set text(e){let t=document.createElement("textarea");t.readOnly=!0,t.title="1",t.style.top=t.style.left="0",t.classList.add("label"),this.panel.appendChild(t),t.value=e,h.dnd.moveable(t)}destroy(){this.panel.remove()}setBackgroundImage(e){this.image.src=e}border(e,t="white"){let o=Se(e)?"":"em";this.panel.style.border=`${e}${o} solid ${t}`}rotateFrame(e){let t=this.panel;if(!!t)if(e)this.transform_node(`rotate(${e}deg)`);else{let o=0,n=t.style.transform;h.repl.animations.animate("rotate",()=>{o+=1,t.style.transform=n+` rotate(${o}deg)`})}}scaleFrame(e){this.transform_node(`scale(${e}, ${e})`)}transform_node(e){let t=this.panel,o=(t.style.transform||"").split(" ");o.unshift(e),t.style.transform=o.join(" ")}asPanel(e){e.classList.add("panel"),e.tabIndex=1;let t=document.createElement("div");t.classList.add("overlay"),this.panel.appendChild(t)}};var q=class{constructor(){this.animations=[]}stop(e){this.animations.map(o=>o).forEach((o,n)=>{(!e||o.type===e)&&(clearInterval(o.handle),this.animations.splice(n,1))})}animate(e,t){this.animations.push({type:e,handle:setInterval(t,100)})}};var z=class{constructor(e){this.commands=e;this.panels=[];this.photos=[];this.commandHistory=[];this.commandHistoryIndex=-1;this.dnd=null;this.animations=new q}notify(e){console.log(e)}use(e){e.extend(this)}eval(e){return u(this,null,function*(){console.log(`executing: ${e}`);let[t]=e.split(" "),o=this.commands.get(t);if(o){yield o.execute(this,ye(e));return}switch(t){case"export":let n=yield this.asCanvas();if(!n)return;let a=document.createElement("img");a.classList.add("export-result"),a.src=n.toDataURL(),document.body.insertBefore(a,document.body.firstElementChild);break}})}asCanvas(){return u(this,null,function*(){return new Promise((e,t)=>{var i;let o=(i=document.querySelector(".canvas"))==null?void 0:i.getBoundingClientRect();if(!o)return;let n=document.createElement("canvas");n.width=o.width,n.height=o.height;let a=n.getContext("2d");if(!a)return;let l=0,s=this.panels.filter(c=>getComputedStyle(c.panel).backgroundImage.indexOf('url("')===0);console.log("loading",s.length),s.forEach(c=>{let w=c.panel.getBoundingClientRect(),y=document.createElement("img");y.crossOrigin="anonymous",y.width=w.width,y.height=w.height,y.style.transform=c.panel.style.transform,y.onload=()=>{a.drawImage(y,w.x,w.y),l++,console.log("loaded:",l),l===s.length&&e(n)};let b=getComputedStyle(c.panel).backgroundImage;console.log("url",b),b=b.substring(5,b.length-2),console.log("url",b),y.src=b})})})}getCollageOverlays(){return Array.from(document.querySelectorAll(".panel[data-id] .overlay"))}getPhotoOverlays(){return Array.from(document.querySelectorAll(".photos .img .overlay[data-id]"))}select(e){var t;return(t=this.selectPanel(e))==null?void 0:t.panel}selectPanel(e){return this.panels.find(t=>t.overlay.dataset.id===e)}selectPhoto(e){return this.photos[parseInt(e)-1]}removePanel(e){let t=this.panels.indexOf(e);if(t===-1)throw"panel not found";this.panels.splice(t,1),e.panel.remove()}reindex(){this.panels.filter(e=>{var t;return!!((t=e==null?void 0:e.panel)==null?void 0:t.parentElement)}).forEach((e,t)=>e.overlay.dataset.id=e.overlay.innerText=t+1+"")}addBehaviors(e){let t=e.overlay,o=this.dnd;o&&(o.zoomable(t),o.draggable(t),o.panable(e),o.droppable(t))}reindexPhotos(){this.photos.forEach((e,t)=>{var a;let o=e.img,n=o.querySelector(".overlay");n||(n=document.createElement("div"),n.classList.add("overlay"),n.dataset.id=n.innerText=1+t+"",o.appendChild(n),(a=this.dnd)==null||a.draggable(n))})}priorCommand(){return this.commandHistoryIndex>0?this.commandHistory[--this.commandHistoryIndex]:""}nextCommand(){return this.commandHistoryIndex<this.commandHistory.length-1?this.commandHistory[++this.commandHistoryIndex]:""}startup(){return u(this,null,function*(){let e=Array.from(document.querySelectorAll(".panel")).map(o=>new E(o));e.forEach(o=>this.addBehaviors(o)),this.panels.push(...e);let t=document.querySelector(".console");t.onkeydown=o=>{switch(o.key){case"Enter":this.executeCommand(t.value),t.value="";break;case"ArrowUp":t.value=this.priorCommand();break;case"ArrowDown":t.value=this.nextCommand();break}},this.reindex()})}executeCommand(e){this.commandHistoryIndex=this.commandHistory.push(e);try{this.eval(e)}catch(t){this.notify(t)}}parseCommand(e){return new G().parsePhrase(e)}};function be(){let r=document.activeElement;if(!r){console.log("no active panel");return}return r.querySelector(".overlay")}function g(r,e){let t=window.getComputedStyle(r).transform;t=t==="none"?"":t+" ",r.style.transform=t+e}function S(r){let{left:e,top:t,width:o,height:n}=getComputedStyle(r);return{top:parseFloat(t),left:parseFloat(e),width:parseFloat(o),height:parseFloat(n)}}var j=class{constructor(e,t){this.repl=e;this.keydownHandlers=t;this.source=null;window.addEventListener("wheel",o=>{let n=be();if(!n){console.log("no active overlay found");return}let a=n.innerHTML,l=1+o.deltaY/1500;e.executeCommand(`zoom ${a} ${l}`)}),window.addEventListener("keydown",o=>{this.keydownHandlers.getEventHandlers(o).some(n=>n.command.execute(e)!==!1)&&o.preventDefault()})}panable(e){let t=e.image,o=[0,0];t.classList.add("draggable"),t.addEventListener("pointerdown",a=>{let l=parseFloat(t.style.left||"0"),s=parseFloat(t.style.top||"0");o=[l-a.screenX,s-a.screenY],t.setPointerCapture(a.pointerId),t.addEventListener("pointermove",n),a.stopPropagation()}),t.addEventListener("pointerup",a=>{t.releasePointerCapture(a.pointerId),t.removeEventListener("pointermove",n);let l=S(t),i=t.getBoundingClientRect().width/l.width;t.style.top=t.style.left="0px",g(t,`translate(${l.left/i}px, ${l.top/i}px)`),a.stopPropagation()});let n=a=>{let[l,s]=[o[0]+a.screenX,o[1]+a.screenY];t.style.left=`${l}px`,t.style.top=`${s}px`,a.stopPropagation()}}moveable(e){let t=[0,0];e.classList.add("draggable"),e.addEventListener("pointerdown",n=>{let a=parseFloat(e.style.top);t=[parseFloat(e.style.left)-n.screenX,a-n.screenY],e.setPointerCapture(n.pointerId),e.addEventListener("pointermove",o),n.stopPropagation()}),e.addEventListener("pointerup",n=>{e.releasePointerCapture(n.pointerId),e.removeEventListener("pointermove",o),n.stopPropagation()});let o=n=>{let[a,l]=[t[0]+n.screenX,t[1]+n.screenY];e.style.top=l+"px",e.style.left=a+"px",n.stopPropagation()}}draggable(e){e.classList.add("draggable"),e.draggable=!0,e.addEventListener("dragstart",t=>this.ondragstart(e))}droppable(e){e.addEventListener("dragover",t=>{!this.source||(t.preventDefault(),this.ondragover(e,this.source))}),e.addEventListener("drop",t=>{!this.source||(t.preventDefault(),this.ondrop(e,this.source))})}zoomable(e){}ondragstart(e){this.source=e}ondragover(e,t){}ondrop(e,t){let o=t.innerHTML,n=e.innerHTML,a=`move ${o} ${n}`;this.repl.executeCommand(a)}};var W=class{constructor(){this.commands={}}nameOf(e){let t=Object.keys(this.commands),o=t.findIndex(n=>this.commands[n].execute===e.execute);return-1<o?t[o]:null}get(e){if(this.commands[e])return this.commands[e];var t=Object.keys(this.commands).find(o=>o.startsWith(e));return t&&this.commands[t]}add(e,t){this.commands[t]=e}list(){return Object.keys(this.commands)}};var dt=document.createElement("textarea");var I=class{constructor(){this.initialized=!1}execute(e,t){let o=document.querySelector(".help");if(!o)throw"cannot show help unless a HTMLSelectElement is defined with a className of 'help'";if(!this.initialized){let n=h.repl.commands.list().map(i=>({command:h.repl.commands.get(i),name:i})),a=h.keyboardHandlers.list(),l=n.map(i=>`<option value="${i.name}">"${i.name}" - ${i.command.about?i.command.about():"command"}</option>`).sort().join(""),s=a.map((i,c)=>`<option value="${i.key}">"${i.key}" - ${i.about}</code></option>`).sort().join("");o.innerHTML=`${l}${s}`,o.addEventListener("change",()=>{document.querySelector(".console").value=o.value})}o.toggleAttribute("hidden")}};function Ie(r){let[e,t,o,n]=[1,2,3,4].map(s=>document.createElement("div")),a=[e,t,o,n].map(s=>new E(s));e.classList.add("q1"),t.classList.add("q2"),o.classList.add("q3"),n.classList.add("q4");let l=r.photo;return l&&a.forEach(s=>s.addPhoto(l.clone())),r.panel.classList.remove("panel"),r.overlay.remove(),r.image.src="",r.panel.classList.add("panel-container"),r.panel.dataset.id="",a.forEach(s=>r.panel.appendChild(s.panel)),a}var U=class{execute(e,t){let o=t,n=e.select(o);if(!n){console.log("no node found");return}let a=e.panels.find(i=>i.panel===n);if(!a){console.log("no panel found");return}let l=e.panels.indexOf(a),s=Ie(a);e.panels.splice(l,1,...s),s.forEach(i=>e.addBehaviors(i)),e.reindex()}};var V=class{about(){return"set the aspect ratio to W H"}execute(e,t){let[o,n]=t.split(" "),a=parseFloat(o),l=parseFloat(n),s=document.querySelector(".window"),i=s.parentElement,c=parseFloat(getComputedStyle(i).width),w=parseFloat(getComputedStyle(i).height),y=c/a,b=w/l,ce=Math.min(y,b);s.style.width=`${Math.round(a*ce)}px`,s.style.height=`${Math.round(l*ce)}px`}};var _=class{about(){return"set the border WIDTH COLOR of ID1 ID2 ..."}execute(e,t){let[o,n,...a]=t.split(" ").filter(s=>!!s);if(!o)throw"width required";if(!n)throw"color required";(a.length?a.map(s=>e.selectPanel(s)):e.panels).forEach(s=>s==null?void 0:s.border(o,n))}};var Ae="px em".split(" ");function $e(r){return Ae.some(e=>r.endsWith(e))}var p=class{constructor(e,t){this.target=e;this.options=t}about(){return`change ${this.target}`}keyboardHandler(e){return e.panels.filter(t=>t.panel.classList.contains("focus")).some(t=>{var l,s,i,c;let o=t.panel,n=getComputedStyle(o),a=parseFloat(n[this.target])+((s=(l=this.options)==null?void 0:l.delta)!=null?s:0);return o.style[this.target]=a+((c=(i=this.options)==null?void 0:i.units)!=null?c:""),!0})}execute(e,t){var i;if(!t)return this.keyboardHandler(e)?void 0:!1;let o=e.panels,[n,...a]=t.split(" ");if(!n)throw"size required";let l=a.length?a.map(c=>e.selectPanel(c)).filter(c=>!!c):o;if(!l.length)return!1;let s=$e(n)?"":((i=this.options)==null?void 0:i.units)||"";l.forEach(c=>{!c||(c.panel.style[this.target]=`${n}${s}`)})}};function Me(r){return document.activeElement===r}var N=class{execute(e,t){let o=document.querySelector(".console");if(!o)return e.notify("no command editor found"),!1;if(Me(o))return!1;o.focus(),o.select()}};function f(r){return r.panels.filter(e=>e.panel.classList.contains("focus"))}function Ce(r,e){let t=r.image,o=e.image,n=t.parentElement,a=o.parentElement;if(!n||!a)return!1;let l=t.nextElementSibling,s=o.nextElementSibling;t.remove(),o.remove(),a.insertBefore(t,s),n.insertBefore(o,l);let i=r.photo,c=e.photo;r.image=o,e.image=t,r.photo=c,e.photo=i}var A=class{keyboardHandler(e){let t=f(e);if(!!t.length){if(t.length!==2)return e.notify("Exactly two panels must be selected before you can perform a swap."),!1;Ce(t[0],t[1])}}about(){return"Swap Panel A B"}execute(e,t){if(!t)return this.keyboardHandler(e);let[o,n]=t.split(" "),a=e.selectPanel(o),l=e.selectPanel(n);if(!a)return e.notify(`Panel not found: ${o}`),!1;if(!l)return e.notify(`Panel not found: ${n}`),!1;Ce(a,l)}};var Y=class{execute(e,t){let o=t,n=e.select(o);!n||n.focus()}};var X=class{execute(e,t){let[o,n]=t.split(" "),a=e.selectPanel(o);!a||(a.text=n)}};var J=class{execute(e,t){let[o,n]=t.split(" "),a=e.select(o);!a||(a.style.padding=`${n}em`)}};function ve(r){return r.style.visibility!=="hidden"}var Q=class{constructor(e){this.options=e}execute(e,t){let o=Array.from(document.querySelectorAll(this.options.selector));o.every(a=>ve(a))?o.forEach(a=>a.style.visibility="hidden"):o.forEach(a=>a.style.visibility="visible")}};function we(r,e,t,o){let[n,a]=[0,0],l=!0,s=1;switch(t){case"up":a=-s;break;case"down":a=s;break;case"left":n=-s;break;case"right":n=s;break;default:l=!1,n=s*parseFloat(t),a=s*parseFloat(o);break}let i=()=>{g(e,`translate(${n}px, ${a}px)`)};i();let c=r.animations;l&&c.animate("pan",i)}var C=class{constructor(e){this.delta=e}about(){var n,a;let e=[],t=((n=this.delta)==null?void 0:n.x)||0,o=((a=this.delta)==null?void 0:a.y)||0;return t>0&&e.push(`${t} px right`),t<0&&e.push(`${-t} px left`),o>0&&e.push(`${o} px up`),o<0&&e.push(`${-o} px down`),`move image ${e.join(" and ")}`}execute(e,t){if(t){let[o,n,a]=t.split(" "),l=e.selectPanel(o);if(!l)return!1;we(e,l.image,n,a||"0")}else if(this.delta){let o=f(e);if(!o.length)return!1;o.forEach(n=>{we(e,n.image,(this.delta.x||0)+"",(this.delta.y||0)+"")})}else return!1}};var Z=class{execute(e,t){let[o,n]=t.split(" "),a=e.select(o);!a||(a.style.margin=`${n}em`)}};function Ke(r,e,t){var l;let o=e.panel;t.panel.classList.forEach(s=>o.classList.add(s)),r.removePanel(t);let a=[1,2,3,4].map(s=>`q${s}`);if(a.every(s=>o.classList.contains(s))){let s=o.parentElement;if(!s)return;s.classList.contains("panel-container")&&(a.forEach(i=>o.classList.remove(i)),a.forEach(i=>s.classList.contains(i)&&o.classList.add(i)),(l=s.parentElement)==null||l.insertBefore(o,s),s.remove())}r.reindex()}var ee=class{execute(e,t){let[o,n]=t.split(" "),a=e.selectPanel(o),l=e.selectPanel(n);a&&l&&Ke(e,a,l)}};var te=class{upgradeResolution(e,t){return u(this,null,function*(){if(!t.photo)return;let o=S(t.image),n=t.image.getBoundingClientRect(),a=n.width/o.width;if(1>a){e.notify("this would not be an upgrade");return}let l=t.panel.getBoundingClientRect();t.image.style.width=n.width+"px",t.image.style.height=n.height+"px";let s=n.left-l.left-parseFloat(t.panel.style.borderLeftWidth),i=n.top-l.top-parseFloat(t.panel.style.borderTopWidth);t.image.style.transform=`translate(${s}px,${i}px)`,t.setBackgroundImage(`${t.photo.mediaInfo.baseUrl}=w${Math.floor(n.width)}`),e.notify(`upgraded by ${Math.round(a*100)}%`)})}execute(e,t){let[...o]=t.split(" ").map(a=>a.trim()).filter(a=>a.length);(o.length?o.map(a=>e.selectPanel(a)):e.panels).forEach(a=>a&&this.upgradeResolution(e,a))}};var oe=class{execute(e,t){let[o,n]=t.split(" "),a=e.selectPhoto(o);if(!a)return;let l=e.selectPanel(n);!l||l.addPhoto(a)}};function Be(r,e,t){if(!!e)if(t)g(e,`rotate(${t}deg)`);else{let o=0;r.animations.animate("rotate",()=>{o+=1,g(e,`rotate(${o}deg)`)})}}var $=class{constructor(e){this.delta=e}about(){return`rotate panel by ${this.delta} deg`}execute(e,t){let o=f(e);if(!o.length)return!1;o.forEach(n=>{let a=n.panel;g(a,`rotate(${this.delta}deg)`)})}},P=class{constructor(e){this.delta=e}about(){return`rotate image by ${this.delta} deg`}execute(e,t){if(t){let[n,a]=t.split(" "),l=e.selectPanel(n);if(!l)return!1;Be(e,l.image,a);return}let o=f(e);if(!o.length)return!1;o.forEach(n=>{let a=n.image;g(a,`rotate(${this.delta}deg)`)})}};var x=class{constructor(e){this.delta=e}about(){let e=[],t=this.delta.x||0,o=this.delta.y||0;return t>0&&e.push(`${t} px right`),t<0&&e.push(`${-t} px left`),o>0&&e.push(`${o} px up`),o<0&&e.push(`${-o} px down`),`move panel ${e.join(" and ")}`}execute(e,t){let o=f(e);if(!o.length)return!1;o.forEach(n=>{let a=n.panel,l=getComputedStyle(a).transform;l==="none"&&(l=""),a.style.transform=l+` translate(${this.delta.x||0}px, ${this.delta.y||0}px)`})}};var M=class{about(){return"Stop Animations"}execute(e,t){if(!e.animations.animations.length)return!1;e.animations.stop(t)}},K=class{about(){return"Toggle focus"}execute(e,t){let o=document.activeElement;if(!(o==null?void 0:o.classList.contains("panel")))return!1;o.classList.toggle("focus")}};var ne=class{constructor(){this.keyboardHandlers=[]}getEventHandlers(e){return this.keyboardHandlers.filter(t=>{let o=t.match;return!(e.altKey!==o.altKey||e.shiftKey!==o.shiftKey||e.ctrlKey!==o.ctrlKey||!!o.key&&e.key!==o.key)})}addEventHandler(e,t){var n,a,l,s;let o={altKey:(n=t.altKey)!=null?n:!1,ctrlKey:(a=t.ctrlKey)!=null?a:!1,shiftKey:(l=t.shiftKey)!=null?l:!1,key:(s=t.key)!=null?s:"",about:t.about||e.about&&e.about()};this.keyboardHandlers.push({match:o,command:e})}list(){return this.keyboardHandlers.map(e=>({command:e.command,key:this.keysAsString(e.match),about:e.match.about}))}keysAsString(e){let t=e.key;switch(t){case" ":t="space";break}return e.ctrlKey&&(t="ctrl + "+t),e.altKey&&(t="alt + "+t),e.shiftKey&&(t="shift + "+t),t}};var ae=class{isPanel(e){return e?e.classList.contains("panel")||e.classList.contains("panel-container"):!1}selectParentPanel(){let e=document.activeElement;if(!!e)for(;e;){if(e=e.parentElement,!e)return;if(this.isPanel(e)){e.focus();return}}}execute(e,t){e.panels.forEach(o=>o.panel.classList.remove("focus")),this.selectParentPanel()}};var v,B=class{constructor(e,t={units:"px"}){this.delta=e;this.options=t;he(this,v,void 0);fe(this,v,(t==null?void 0:t.units)||"px")}about(){return this.delta>0?`increase font by ${this.delta}${T(this,v)}`:`decrease font by ${-this.delta}${T(this,v)}`}isLabel(e){return e?e.classList.contains("label"):!1}execute(e,t){let o=document.activeElement;if(!this.isLabel(o))return!1;let n=parseFloat(getComputedStyle(o).fontSize);o.style.fontSize=`${n+this.delta}${T(this,v)}`}};v=new WeakMap;var re=class{constructor(){this.peopleApiDiscovery="";this.scopes="https://www.googleapis.com/auth/photoslibrary.readonly";this.authorizeButton=null;this.signoutButton=null;this.ready=()=>{}}handleClientLoad(){return u(this,null,function*(){yield new Promise((n,a)=>{gapi.load("client:auth2",n)});let t=yield(yield fetch("./web/credentials.json")).json(),o=yield fetch("./web/photos_rest_v1.json");this.peopleApiDiscovery=yield o.json(),yield this.initClient(t)})}initClient(e){return u(this,null,function*(){if(this.authorizeButton=document.getElementById("authorize-button"),!this.authorizeButton)throw"a clickable element must exist with id of 'authorize-button'";if(this.signoutButton=document.getElementById("signout-button"),!this.signoutButton)throw"a clickable element must exist with id of 'signout-button'";return new Promise((t,o)=>u(this,null,function*(){this.ready=()=>t(),yield gapi.client.init({apiKey:e.apiKey,discoveryDocs:[this.peopleApiDiscovery],clientId:e.clientId,scope:this.scopes}),gapi.auth2.getAuthInstance().isSignedIn.listen(n=>this.updateSigninStatus(n)),this.updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get()),this.authorizeButton.onclick=()=>this.handleAuthClick(),this.signoutButton.onclick=()=>this.handleSignoutClick()}))})}updateSigninStatus(e){e?(this.authorizeButton.style.display="none",this.signoutButton.style.display="block",this.ready()):(this.authorizeButton.style.display="block",this.signoutButton.style.display="none")}handleAuthClick(){gapi.auth2.getAuthInstance().signIn()}handleSignoutClick(){gapi.auth2.getAuthInstance().signOut()}};var le=class{getAlbums(){return u(this,null,function*(){yield new re().handleClientLoad();let t=yield gapi.client.photoslibrary.albums.list();if(t.status!==200)throw`status: ${t.status}`;console.log({resp:t});let o=t.result.albums;for(;t.result.nextPageToken;){if(t=yield gapi.client.photoslibrary.albums.list({pageToken:t.result.nextPageToken}),t.status!==200)throw`status: ${t.status}`;console.log({resp:t}),o=o.concat(t.result.albums)}return o})}getAlbum(e){return u(this,null,function*(){let t=yield gapi.client.photoslibrary.mediaItems.search({albumId:e.id}),{mediaItems:o}=t.result;for(;t.result.nextPageToken;)t=yield gapi.client.photoslibrary.mediaItems.search({albumId:e.id,pageToken:t.result.nextPageToken}),o.push(...t.result.mediaItems);return o})}getPhoto(e){return u(this,null,function*(){return(yield gapi.client.photoslibrary.mediaItems.get({mediaItemId:e})).result})}};var se=class{};var H=class extends se{constructor(e){super();this.mediaInfo=e;let t=this.img=document.createElement("div");t.classList.add("img"),t.style.backgroundImage=`url(${this.mediaInfo.baseUrl})`,t.title=e.filename}renderInto(e){e.appendChild(this.img)}clone(){return new H(JSON.parse(JSON.stringify(this.mediaInfo)))}};var ie=class{execute(e,t){return u(this,null,function*(){if(!t){yield this.openAlbums(e);return}let o=t.split(",");yield this.openAlbums(e,o)})}openAlbums(e,t){return u(this,null,function*(){let o=new le,n=document.querySelector(".photos");if(n){let a=yield o.getAlbums();t&&(a=a.filter(l=>-1<t.indexOf(l.title))),a.forEach(l=>u(this,null,function*(){console.log(`opening album: ${l.id} (${l.title})`),(yield o.getAlbum(l)).forEach(i=>{let c=new H(i);e.photos.push(c),c.renderInto(n),e.reindexPhotos()})}))}})}};var me=class{extend(e){window.addEventListener("click",t=>{t.shiftKey||e.panels.forEach(n=>n.panel.classList.remove("focus"));let o=t.composedPath();o=o.filter(n=>{var a;return((a=n==null?void 0:n.classList)==null?void 0:a.contains("panel"))===!0}),o.forEach(n=>n.classList.toggle("focus"))})}};var de=class{constructor(e){this.toaster=e}extend(e){let t=e.notify;e.notify=o=>{t(o),this.toaster.toast(o)}}};function xe(r,e,t){let o=e.image;if(!!o)if(t){let n=parseFloat(t);g(o,`scale(${n},${n})`)}else{let n=getComputedStyle(o).width,a=parseFloat(n)/100;r.animations.animate("zoom",()=>{a*=1.01,o.style.width=`${100*a}%`})}}var R=class{constructor(e){this.scale=e}about(){return`scale panel by ${(this.scale||0).toFixed(3)}`}execute(e,t){if(t){let[n,a]=t.split(" "),l=e.selectPanel(n);if(!l)return!1;l.scaleFrame(a)}let o=f(e);if(!o.length)return!1;o.forEach(n=>{n.scaleFrame(this.scale+"")})}},L=class{constructor(e){this.scale=e}about(){return`scale image by ${(this.scale||0).toFixed(3)}`}execute(e,t){if(t){let[n,a]=t.split(" "),l=e.selectPanel(n);if(!l)return!1;xe(e,l,a);return}if(!this.scale)return!1;let o=f(e);if(!o.length)return!1;o.forEach(n=>{xe(e,n,this.scale+"")})}};var Fe={sc:"M10,30 A20,20,0,0,1,50,30 A20,20,0,0,1,90,30 Q90,60,50,90 Q10,60,10,30 Z"},Ee={};function De(r){let e=Ee[r];return e||(e=document.createElementNS("http://www.w3.org/2000/svg","path"),e.id=r,e.setAttribute("d",Fe[r]),Ee[r]=e),e}var pe=class{about(){return"applies an SVG filter to an image"}execute(e,t){let[o,...n]=t.split(" ").filter(s=>!!s),a=n.length?n.map(s=>e.selectPanel(s)):e.panels,l=De("sc");a.forEach(s=>{s.panel.style.clipPath="url(#heart)"})}};var Pe=new D(document.querySelector(".toaster")),m=new W,k=new z(m),d=new ne;k.use(new me);k.use(new de(Pe));d.addEventHandler(new I,{key:"?",about:"Help"});d.addEventHandler(new ae,{key:"Escape"});d.addEventHandler(new B(1),{key:"+"});d.addEventHandler(new B(-1),{key:"-"});d.addEventHandler(new R(1.01),{shiftKey:!0,key:"+"});d.addEventHandler(new R(1/1.01),{shiftKey:!0,key:"-"});d.addEventHandler(new L(1.01),{key:"+"});d.addEventHandler(new L(1/1.01),{key:"-"});d.addEventHandler(new P(1),{key:"."});d.addEventHandler(new P(-1),{key:","});d.addEventHandler(new $(1),{shiftKey:!0,key:">"});d.addEventHandler(new $(-1),{shiftKey:!0,key:"<"});d.addEventHandler(new x({x:-1}),{shiftKey:!0,key:"ArrowLeft"});d.addEventHandler(new x({x:1}),{shiftKey:!0,key:"ArrowRight"});d.addEventHandler(new x({y:1}),{shiftKey:!0,key:"ArrowDown"});d.addEventHandler(new x({y:-1}),{shiftKey:!0,key:"ArrowUp"});d.addEventHandler(new C({x:-1}),{shiftKey:!1,key:"ArrowLeft"});d.addEventHandler(new C({x:1}),{shiftKey:!1,key:"ArrowRight"});d.addEventHandler(new C({y:1}),{shiftKey:!1,key:"ArrowDown"});d.addEventHandler(new C({y:-1}),{shiftKey:!1,key:"ArrowUp"});d.addEventHandler(new p("top",{delta:1,units:"px"}),{key:"t"});d.addEventHandler(new p("top",{delta:-1,units:"px"}),{shiftKey:!0,key:"T"});d.addEventHandler(new p("left",{delta:1,units:"px"}),{key:"l"});d.addEventHandler(new p("left",{delta:-1,units:"px"}),{shiftKey:!0,key:"L"});d.addEventHandler(new p("bottom",{delta:1,units:"px"}),{key:"b"});d.addEventHandler(new p("bottom",{delta:-1,units:"px"}),{shiftKey:!0,key:"B"});d.addEventHandler(new p("right",{delta:1,units:"px"}),{key:"r"});d.addEventHandler(new p("right",{delta:-1,units:"px"}),{shiftKey:!0,key:"R"});d.addEventHandler(new p("width",{delta:1,units:"px"}),{key:"w"});d.addEventHandler(new p("width",{delta:-1,units:"px"}),{shiftKey:!0,key:"W"});d.addEventHandler(new p("height",{delta:1,units:"px"}),{key:"h"});d.addEventHandler(new p("height",{delta:-1,units:"px"}),{shiftKey:!0,key:"H"});d.addEventHandler(new A,{ctrlKey:!0,key:"s"});d.addEventHandler(new M,{shiftKey:!0,key:" "});d.addEventHandler(new N,{key:"c",about:"goto commands"});d.addEventHandler(new K,{shiftKey:!0,key:" "});d.addEventHandler(new K,{shiftKey:!1,key:" "});var He=new j(k,d);k.dnd=He;m.add(new I,"?");m.add(new ie,"open");m.add(new V,"aspect");m.add(new _,"border");m.add(new pe,"clip");m.add(new Y,"goto");m.add(new te,"hires");m.add(new Z,"margin");m.add(new ee,"merge");m.add(new oe,"move");m.add(new J,"pad");m.add(new P,"rotate");m.add(new R,"scale");m.add(new A,"swap");m.add(new U,"split");m.add(new M,"stop");m.add(new X,"text");m.add(new C,"translate");m.add(new C,"pan");m.add(new L,"zoom");m.add(new p("backgroundColor"),"bgc");m.add(new Q({selector:".collage .panel-container .overlay"}),"overlay");m.add(new p("borderColor"),"bc");m.add(new p("borderTopColor"),"bct");m.add(new p("borderBottomColor"),"bcb");m.add(new p("borderLeftColor"),"bcl");m.add(new p("borderRightColor"),"bcr");m.add(new p("borderWidth",{units:"px"}),"bw");m.add(new p("borderBottomWidth"),"bwb");m.add(new p("borderTopWidth"),"bwt");m.add(new p("borderLeftWidth"),"bwl");m.add(new p("borderRightWidth"),"bwr");m.add(new p("opacity"),"opacity");m.add(new p("borderRadius"),"br");m.add(new p("borderTopLeftRadius"),"brtl");m.add(new p("borderTopRightRadius"),"brtr");m.add(new p("borderBottomLeftRadius"),"brbl");m.add(new p("borderBottomRightRadius"),"brbr");m.add(new p("width",{units:"em"}),"width");m.add(new p("height",{units:"px"}),"height");m.add(new p("zIndex"),"z");Pe.toast("Welcome!");var h={allowSpeechRecognition:!1,debug:!0,repl:k,dnd:He,keyboardHandlers:d};function Re(){return u(this,null,function*(){let r=h.repl;if(yield r.startup(),h.allowSpeechRecognition){let e=new F;e.listen(),e.on("speech-detected",t=>{r.executeCommand(r.parseCommand(t.result))})}r.getPhotoOverlays().forEach(e=>{h.dnd.draggable(e),console.log(`${e.innerHTML} is draggable`)})})}function Ge(){return u(this,null,function*(){Re();let r=h.repl;r.eval("aspect 4 6"),h.debug&&(r.eval("split 1"),r.eval("merge 4 3"),r.eval("split 2"),r.eval("merge 4 5"),r.eval("merge 2 3"),r.eval("bw 1em"),r.eval("bc white"),r.eval("bgc silver"),yield r.eval("open 2019"),setTimeout(()=>{let e=document.querySelectorAll(".collage .panel").length,t=document.querySelectorAll(".collage .photos .img").length;for(let o=1;o<=e;o++)r.eval(`move ${1+(o-1)%t} ${o}`)},3e3))})}Ge();})();
//# sourceMappingURL=index.js.map
