<html>

<head>
    <title>Render a Map of the World</title>
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            display: block;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: black;
            color: white;
        }

        .workarea {
            position: absolute;
            transform: rotate(0deg);
        }

        #moon1 {
            transition: d 1s;
        }

        #moon4 {
            offset-path: path('M0,150h100 v200 h-200 v-200 Z');
            animation: followpath 10s linear infinite;
            motion-offset: 0%;
            offset-distance: 0%;
        }

        @keyframes followpath {
            to {
                motion-offset: 100%;
                offset-distance: 100%;
            }
        }
    </style>
</head>

<body>
    <svg class="workarea" viewbox="-500 -500 1000 1000">
        <defs>
            <pattern id="pattern1" patternUnits="userSpaceOnUse" x="0" y="0" width="10" height="10"
                viewBox="-5 -5 10 10">
                <rect x="-4" y="-4" width="8" height="8" fill="gold" />
                <circle cx="0" cy="0" r="3" fill="black" />
            </pattern>
            <filter id="filter1">
                <feGaussianBlur stdDeviation="1" />
            </filter>
            <radialGradient id="gradient1" gradientUnits="userSpaceOnUse" cx="0" cy="0" r="10">
                <stop offset="0%" stop-color="white" />
                <stop offset="10%" stop-color="red" />
                <stop offset="20%" stop-color="orange" />
                <stop offset="40%" stop-color="yellow" />
                <stop offset="60%" stop-color="green" />
                <stop offset="80%" stop-color="blue" />
                <stop offset="90%" stop-color="violet" />
                <stop offset="100%" stop-color="white" />
            </radialGradient>
        </defs>
        <g fill="rgba(255,255,255,0.9)">
            <defs>
                <path id="path1" d="M -50 50 l 50 0 l 50 -0" />
                <path id="path2" d="M 0 0 l 0 50 Z" />
            </defs>
            <circle cx="0" cy="-250" r="60" fill="url(#pattern1)" />
            <text x="-30" y="30" font-family="Verdana" font-size="16">SVG A-Z</text>
            <text style="font: 20px sans-serif;">
                <textPath href="#path1">Daniel Alix</textPath>
            </text>

            <line x1="0" y1="0" x2="-500" y2="-500" stroke="green" />
            <path d="M 0 0 l 500 -500 Z" stroke="yellow" />
            <ellipse rx="10" ry="8" fill="blue" />
            <circle cx="0" cy="0" r="3" fill="orange" />
            <polygon points="-400,-400 -350,-350 -300,-400 -300,-300 -350,-250 -400,-300" />
            <circle cx="250" cy="0" r="60" filter="url(#filter1)" fill="url(#pattern1)" />
            <g id="target">
                <circle transform="translate(0,250) scale(6)" cx="0" cy="0" r="10" fill="url(#gradient1)" />
                <path id="moon1" transform="translate(0,250) scale(2)" stroke="orange" stroke-width="2" fill="none"
                    d="">
                    <animate attributeType="XML" attributeName="d"
                        from="M -5.877853 8.090170l 5.877853 21.909830 l 5.877853 -21.909830 l 22.653843 1.180340 l -19.021130 -12.360680 l 8.122992 -21.180340 l -17.633558 14.270510 l -17.633558 -14.270510 l 8.122992 21.180340 l -19.021130 12.360680 l 22.653843 -1.180340"
                        to="M -5.877853 8.090170l 5.877853 61.909830 l 5.877853 -61.909830 l 60.696104 13.541020 l -57.063391 -24.721360 l 31.634402 -53.541020 l -41.144968 46.631190 l -41.144968 -46.631190 l 31.634402 53.541020 l -57.063391 24.721360 l 60.696104 -13.541020"
                        dur="1s" fill="freeze" begin="indefinite" />
                </path>
                <circle id="moon2" transform="translate(0,250) scale(2)" cx="0" cy="50" r="10" fill="white">
                    <animateTransform attributeName="transform" type="rotate" from="0" to="360" repeatCount="indefinite"
                        dur="10s" additive="sum" fill="freeze" />
                </circle>
                <circle id="moon3" transform="translate(0,250) scale(2)" cx="-50" cy="0" r="10" fill="blue">
                    <animateMotion dur="10s" repeatCount="indefinite" path="M0,0 l100,-100 l100,100 l-100,100 z" />
                </circle>
                <circle id="moon4" transform="translate(0,0) scale(2)" cx="0" cy="-0" r="10" fill="green">
                </circle>
            </g>
            <rect x="300" y="-400" width="100" height="100" rx="30" ry="10" />
            <image xlink:href="../../assets/ca0v.png" x="-300" y="-50" width="100" height="100"
                filter="url(#filter1)" />
        </g>
    </svg>
    <script>
        (function () {

            function range(n) {
                return Array(n).fill();
            }

            function circle(r, count, offset) {
                r = r || 100;
                let dr = 2 * Math.PI / count;
                return range(count).map((_, i) => {
                    let x = r * Math.sin((i + offset) * dr);
                    let y = r * Math.cos((i + offset) * dr);
                    return ({ x, y });
                });
            }

            function round6(n) {
                return n.toFixed(6);
            }

            function star(r1, r2, count) {
                let c1 = circle(r1, count, 0);
                let c2 = circle(r2, count, 0.5);
                return c1.reduce((arr, v, i) => arr.concat(v, c2[i]), []);
            }

            function xySvg(xy) {
                return xy.map(({ x, y }, i) => {
                    if (i === 0) {
                        let lastItem = xy[xy.length - 1];
                        let [dx, dy] = [x - lastItem.x, y - lastItem.y];
                        return `M ${round6(lastItem.x)} ${round6(lastItem.y)} l ${round6(dx)} ${round6(dy)}`;
                    }
                    return `l ${round6(x - xy[i - 1].x)} ${round6(y - xy[i - 1].y)} `;
                }).join("");
            }

            function zoomTarget(selector, points) {
                let target = document.querySelector(selector);
                let animation = target.querySelector("animate");
                let starPoints = xySvg(star(100, 10, points));
                let circlePoints = xySvg(circle(100, 2 * points, -0.5));
                console.log(starPoints, circlePoints);
                animation.setAttribute("from", circlePoints);
                animation.setAttribute("to", starPoints);
                animation.beginElement();
                setTimeout(() => {
                    animation.setAttribute("to", circlePoints);
                    animation.setAttribute("from", starPoints);
                    animation.beginElement();
                }, 3000);
            }

            // it is possible to @keyframes "d" on a path
            // would like to morph down to a circle with same point count
            // then to a circle with new point count
            // then to a star with new point count
            let count = 3;
            zoomTarget("#moon1", count++);
            let h = setInterval(() => {
                if (count > 10) count = 3;
                zoomTarget("#moon1", count++);
                //clearInterval(h);
            }, 5000);

        })();
    </script>
</body>

</html>